//
//  ArtDataManager.swift
//  MarsAndMore
//
//  Created by Michael Adams on 8/11/22.
//

import Foundation
import Combine

class ArtDataManager: ObservableObject
{
    @Published var artData = [MetImageData]()
    var cancellables = Set<AnyCancellable>()
    // hard coded objects for now in one place. will be making currated lists to choose art of day
    let venusObjects = [38141, 736558, 811890, 207593, 435826, 437891, 436322, 438127, 13202, 437310, 447802, 188325, 198134, 692509, 717152, 360094, 369550, 845724, 437314, 55392, 407365, 737925, 811971, 819742, 739361, 742689, 54010, 396879, 813293, 819448, 394745, 437227, 720282, 342902, 823883, 774799, 693138, 436330, 633712, 820845, 787982, 468064, 834082, 390795, 787969, 774746, 211462, 392799, 392655, 392648, 391536, 392802, 392650, 816515]
    // 2606
    let segment = 5
    // love search
    let selectArt = [281940,38141,488319,736558,435826,811890,693667,475487,437891,207593,436322,490222,499568,112900,38598,438127,13060,889329,746246,194458,124263,499032,103288,103286,103289,103287,103290,94556,158848,106028,841605,102923,102924,103284,103292,103291,104957,13202,464125,437310,1894,7595,476552,207665,468732,267,468737,477221,489721,4897,4896,206705,481456,206578,231704,231703,231702,231681,206307,231682,231683,231679,231676,231698,231701,231697,231699,231675,231700,231678,206306,231686,231685,231684,206773,206296,206298,206704,206577,231677,206295,206343,447802,188325,367989,395968,198134,10839,692509,484828,377261,742824,206702,255253,255258,467733,255252,204607,204606,204602,204601,204605,204604,204603,204609,204599,204608,204598,204600,451894,204504,644896,717152,446542,10011,3174,10013,665567,284168,395969,360094,360095,369550,257626,367886,413623,5873,437314,438169,206873,490044,845724,482656,195267,236793,192145,55118,363372,650899,43081,55392,407365,78661,819742,737925,811971,742689,739361,204977,412783,54010,483247,337895,396879,813293,491480,787700,19099,437227,394745,819448,222042,206043,390714,363706,377260,342902,720282,404897,823883,823941,693138,774799,436330,492349,7,8,771874,204503,1899,268,1901,3794,1896,1900,491351,665557,665563,812958,35912,35913,477779,633712,70770,70769,204826,451886,451885,57169,451893,60138,206774,57171,468731,468728,468730,468735,468729,468736,468733,50802,204506,57170,204825,206775,204827,204824,204823,468727,259145,259164,259161,259149,259159,259166,259170,259155,7594,204822,63939,259147,259158,259162,204508,259150,259168,259153,259157,259165,259163,259171,36448,259146,259156,259151,259154,259169,259160,204505,343353,202971,92369,98728,108567,58456,206332,820845,98727,94802,255259,199464,746095,175867,852384,255180,80891,199463,169938,98726,259152,259148,259167,372190,157337,787982,468064,158990,478979,204513,390795,834082,787959,787969,774746,811683,811685,211462,478985,339176,490002,392799,392648,392655,391536,392652,392650,816515,392802,392808,392835,392666,392661,392665,392667,392657,392653,392660,392663,392659,392664,392654,392668,392837,392834,392831,392806,392836,392838,392832,392805,392833,334653,397867,397870,397872,397865,425363,344913,57035,503048,340432,376191,452805,283748,811211,648576,78671,742878,383694,1920,1921,8094,426343,334654,193848,4985,11157,24907,499033,854846,482197,459427,448671,369946,360249,692480,446,263975,263974,334856,369384,369293,557687,557674,544572,548573,362018,712785,557804,302519,557746,544557,544592,544597,544563,666318,339045,357171,364213,557727,336278,340847,371805,336883,667858,364381,487261,494748,460424,661709,227163,502377,9195,11207,13758,478986,488693,55371,36921,36666,360403,661734,337877,347987,387100,336353,56815,340963,742765,437442,247487,78664,392625,717183,736913,203428,745539,737578,192693,426335,193853,853967,489124,250419,21990,435713,888555,455028,254646,437532,1656,485387,669875,470149,651992,37942,716525,435727,751109,13143,778476,38430,436918,98475,98474,778480,485902,485903,778479,778477,761737,751117,83144,812964,812965,812963,665565,751116,85978,97591,83309,381431,827573,665555,193614,751110,751107,95426,827536,827552,827572,827569,827574,827564,827577,827590,827587,827561,208167,734657,812956,812954,35911,827568,827578,81102,471817,827580,827555,827575,734681,97241,751113,97270,97558,665553,14506,321187,21304,812957,812961,849466,734683,778701,734682,382852,437535,488486,469887,451752,200668,204804,205431,436516,544053,550263,246657,888592,247904,21284,61635,464136,437987,191081,207849,230011,229933,665566,471357,813132,813256,810877,435743,36616,401151,37140,361833,737880,717484,717486,717487,737875,463550,717483,191139,736923,737871,631209,811251,811252,37872,37122,195818,437059,468195,727148,726126,70486,19765,310282,821352,81137,435666,11993,484216,572219,282043,399977,728418,399912,400209,337690,260162,399895,717136,767896,415742,820057,736924,737549,737813,737811,193706,824727,785911,785928,777064,778657,561100,623041,558689,251022,193702,460800,475489,242017,254502,446105,446106,456098,456151,453857,446102,13604,195447,17066,503799,464046,11678,478984,446104,247347,208343,2791,202541,822779,822774,3757,11712,205421,706317,85315,253610,31301,7887,202214,20519,329227,436056,438158,467760,250945,255247,436037,251134,436994,188827,226696,197226,255720,20549,451490,45009,45012,717485,736899,771297,558679,553375,752367,736918,737895,473331,547628,750929,337500,451729,453860,446145,446143,445965,456093,445015,10240,12845,12554,12651,87016,12699,44910,671056,857064,437525,191292,191329,737763,839191,469903,257642,256949,65594,256241,463747,459205,52777,40055,464246,6008,207492,334650,438435,446603,711029,436945,845714,16805,456082,451728,205084,437588,40766,255432,437488,57675,500666,435762,436041,436896,204517,191597,1009,436069,435829,724747,665918,397527,544740,437878,701639,11994,12013,503765,204640,282163,557739,481962,1226,709109,491320,248307,253556,254547,446608,37962,715062,751041,711826,397686,551003,463576,463577,9788,3860,4894,848283,207870,454042,553447,249383,471343,205526,504490,196533,248593,466245,327369,256219,435665,436489,292065,27019,505731,199071,211493,459038,459037,737755,489687,490036,88645,317978,207666,20558,251182,817923,552237,11326,551324,192721,10785,20301,282740,255878,452672,13057,459028,459027,436834,460203,460235,5997,1017,751018,38353,38323,459060,473403,334797,384500,248143,247402,254697,254710,439933,437327,26445,468661,472180,558713,437346,446595,548212,438126,467643,471130,505719,476944,199118,739055,239400,239397,239398,239399,436000,436906,16850,20561,20560,467653,467654,852271,435738,436453,84187,648075,436042,24192,656829,322585,661045,661724,485243,41900,38236,38397,43774,444554,845726,464660,210789,20141,475488,253569,435844,853475,544499,484870,231923,231926,231922,231924,231925,206585,461567,367876,444579,204674,479089,890009,453011,450358,281926,266258,464248,454601,468742,475552,785032,191366,408271,211383,56593,642940,437339,446549,24930,361900,747218,361888,56151,84192,489963,207381,437926,335682,446553,545393,544201,555216,251474,453253,195226,45496,194305,206833,641794,341210,384474,384470,384467,384473,384475,392656,306324,788072,317829,545935,199500,438022,838102,839765,838105,424143,634108,551786,460202,437393,436325,634105,357116,436910,188830,56680,437402,726097,14092,44738,204791,437880,765289,544692,203008,52872,436150,436051,441769,466178,647338,467691,437069,684673,324937,195473,503676,205503,446552,734066,767102,496221,778036,437177,436904,399942,84188,437827,57140,57077,392779,390241,787929,789158,74846,207263,438112,437398,437749,21686,207406,199737,450713,391957,771563,435772,336058,84190,775419,341079,361902,45505,209053,209052,364035,201886,209051,209043,209049,209050,209042,747607,486601,414153,387164,734372,734415,734062,57011,54855,392807,392856,392804,414503,414630,414437,414424,394057,392649,392651,392658,229934,634352,789058,341212,384469,384468,384472,384471,421361,432574,432572,788253,487814,631210,700289,341553,719121,368263,350079,416815,463713,193883,446176,550893,218689,314362,438659,35794,452111,452160,370495,374034,374036,105663,786765,489648,467732,437476,436603,312279,364068,436989,341275,159437,436845,436858,667865,761114,110121,55335,36632,786774,839081,464133,157153,45015,187262,436930,84508,87613,40232,489624,45671,368043,222227,204888,336607,286435,190062,54197,460840,36047,11376,226422,363800,363801,853409,733752,265188,229303,811279,811280,83741,36731,45085,362021,199401,359089,265148,734383,738512,738540,209151,209144,10170,37808,469869,24935,24852,662067,443640,668572,774509,461150,781713,345058,450724,394050,392803,414920,413469,416816,416819,396035,361925,634353,376853,376691,397803,392931,392932,37998,729644,363637,193617,757955,497874,467766,37911,437826,464760,436988,500399,774275,778066,778684,451270,363903,459250,736212,811501,811498,440326,342704,51999,490045,466380,193709,188503,484415,355576,857441,734423,717439,365764,544007,547780,10139,203893,544320,202149,266926,205042,435747,436572,440900,282314,204758,437313,437955,453336,480553,459065,474336,446567,848297,131576,843752,283090,767107,781715,717774,738526,704612,781761,53219,436570,436511,437080,436903,84606,659875,203938,662782,45065,181654,181656,181653,181655,337969,671020,366421,336411,158202,237057,436905,446565,356244,349560,355377,204520,219857,367163,55012,55013,55015,55014,55016,51391,49633,482565,20635,201862,346442,204885,394049,396177,399625,416818,739719,221406,416863,361824,426349,426352,410864,737827,748722,436582,438661,712072,39724,53655,156808,155773,38213,677492,677495,625023,78223,55174,436866,486739,40188,194325,65623,461463,456095,456092,37897,42148,55817,37281,269242,822466,446138,446139,446136,446140,55179,446142,36659,45426,54660,10967,361887,360017,361890,361889,361899,481994,480740,334963,491698,38017,228954,458644,308245,756458,336780,283707,283704,271522,359161,351992,369313,260779,84244,57569,37992,37097,57664,670968,73148,334327,342383,130577,82635,398522,486545,486564,254675,483410,446543,838982,468350,37893,459386,55920,56992,13198,639883,490604,316525,283705,283708,74691,130566,195057,44938,17087,787842,787840,787846,45077,131371,155710,446594,667125,334006,334021,343715,416907,343334,764174,456088,490019,76558,459965,60789,845709,365736,450588,459066,452628,437944,847024,197742,632959,453212,456170,438110,437023,638173,781930,406717,417560,423398,423347,423356,423355,423404,435818,707799,767110,765766,659387,198700,468672,468620,35919,375837,123954,122607,670501,768114,767793,767795,360354,192035,15244,471236,195863,93755,443176,485416,436795,341762,227205,825523,340951,36543,37118,237017,670977,197995,468512,435768,201802,201769,482668,382608,485147,489307,446546,156515,665778,671015,77190,55793,51995,37275,657392,156596,37114,157658,671032,671053,360319,423142,392464,286592,269297,853391,762111,155853,423580,363579,344006,341811,739485,834757,207784,210673,186268,59253,130563,17499,407548,656031,787848,787850,787847,787843,811170,45068,374014,64073,455548,468558,337932,11156,761822,487300,367715,758532,698643,490042,823663,39664,212620,187179,209287,725275,725969,717420,719806,732580,734364,765288,765063,765798,765071,765791,767106,448183,546037,775441,206876,444605,228264,436155,438821,441965,436179,202152,199942,438815,449020,451723,452112,452132,700937,708003,423579,227725,633672,787845,787849,787844,787851,787841,49172,758578,655412,655441,655442,37368,416808,221405,655411,819963,37815,399240,156384,206291,438021,544364,626692,53439,765654,453341,451279,49652,157264,157299,156818,44521,156995,267599,345778,336251,767652,489234,489236,366344,156088,369672,40280,37358,679686,339159,823557,159451,665702,495241,396361,200744,357017,460053,187831,829364,81472,364045,53204,391860,53246,464245,72777,231657,437506,736213,736203,65628,386045,819946,227540,193714,229096,436526,204724,222504,218690,364423,785034,768120,778056,778827,726682,726671,730741,187232,765035,765811,765800,719954,40999,719123,210796,302002,719933,266588,734041,421150,5149,446618,694169,204630,196102,736252,196392,236140,218749,207899,205383,726733,262236,341145,355316,197743,471562,437638,785035,778832,481921,493711,493709,436838,728088,435714,853185,767805,768560,726022,14088,447397,228469,437112,437007,207814,446563,158314,54863,78255,366729,341366,720961,38056,337833,130622,320479,320478,501351,838158,838160,336248,131335,157246,64535,337852,104898,81319,759290,335083,482500,486554,44941,786863,237036,42105,78670,638191,421308,423403,423353,469719,158055,849491,459077,36593,77799,227724,452120,641281,393723,446605,226695,340443,820414,268348,45754,283261,358306,302466,65611,383101,392572,49010,452846,742532,221866,137982,359451,681581,681795,681794,681866,681655,408989,56534,451258,404393,76462,45214,317820,670913,41493,626150,445750,764823,764825,764821,738482,764824,764838,764800,764828,764796,764822,764826,764795,764794,294506,745550,764773,764770,764766,764778,764772,764780,764791,764775,764790,764786,764777,764783,764788,764762,764776,764779,764781,764768,764787,764789,764784,764774,764765,764771,764792,764767,764764,764785,764782,764769,764813,764808,764809,764807,764812,764811,764810,764806,291762,291787,291822,291784,291763,291788,764836,764799,764816,764817,764832,764802,764818,764820,764819,764835,764814,764834,764815,764831,764801,764830,764803,12961,364186,373502,267857,83879,764793,16907,764833,764763,64890,764837,74837,310941,138004,349730,155988,398147,283105,483143,825835,706802,73159,34790,480743,468673,468642,481231,256403,688569,296355,288310,358889,446609,45773,13209,501879,845125,436201,501977,27890,845138,427118,649023,736194,352412,358319,227206,197213,736199,201874,202384,451741,446561,448672,451286,451725,452182,452145,107837,437229,158085,453345,42563,269335,786126,156186,283096,849514,436485,205398,72804,72788,233017,233019,233020,233022,233018,233021,208200,77233,819647,819646,767081,44886,460423,786860,687861,360268,814560,283276,222229,505139,504794,82566,503196,505138,284093,501561,283226,283249,128828,330097,130669,87361,189697,231921,45366,237052,341242,646420,811817,646433,205440,453283,96524,81560,83335,813665,681580,681642,681632,853202,88649,45375,79193,764797,36429,764829,72781,267836,662759,36048,55595,283097,764827,760590,5263,52701,44848,685040,314791,314789,314790,314793,316178,452122,455041,350114,662604,188880,383096,231721,488903,203128,365313,39543,53013,490034,354230,216511,362403,717355,717367,722053,722075,719896,726740,728100,728102,732579,734362,738515,202422,186616,765047,765046,768116,767105,765815,765810,396259,302290,56607,198434,187526,722044,786256,14041,14077,14043,14083,14050,14090,14102,16403,392962,414914,719802,722079,729577,718392,719117,775411,201758,499549,260728,347415,226809,456205,189063,188182,187167,778755,306176,486941,497589,367350,16464,389113,193934,489706,454764,742515,744098,228221,228252,228245,228004,228501,347413,778047,781717,778069,778844,376140,816029,441226,40081,39668,73650,53194,436836,78920,483484,436007,464300,248206,242004,438726,488732,733847,662785,306293,784631,475527,436267,459043,452523,228282,436097,436377,192065,190646,734360,62987,62989,56147,62988,36488,416806,36092,14084,698484,414435,651670,195810,306261,20550,205059,17182,452102,745547,448240,446273,687402,228248,228470,228487,36262,785126,72797,436973,835010,688823,764798,373998,504283,159185,829382,159230,156996,155839,325979,325978,459053,194859,490004,209415,238927,189431,849507,57282,395637,395538,394460,395286,395419,368082,368080,368083,488865,484894,490223,436151,437160,749639,436576,53245,317911,317909,318380,77885,227738,505202,503185,503705,501553,44908,185392,681774,853336,845154,823342,451726,283267,383095,383094,847083,202258,322586,684343,155840,849495,820022,72786,468721,468744,775410,775414,781963,736209,756854,416750,459070,16404,392694,373479,377079,205060,708000,19443,392946,395310,228225,227975,196062,823881,722036,461196,451282,229930,436245,670765,30169,158501,502045,358856,24307,195559,395368,231238,436323,437083,489996,486754,488711,487717,157880,725400,265403,193340,428556,437754,437523,369615,369378,156692,159537,742537,435941,437218,121191,198929,198746,489701,455076,283256,436679,322362,329069,435819,437854,457728,483517,369388,381940,381938,381942,381943,381941,381939,204518,318023,681293,682048,736196,763149,782061,486932,49804,14069,14080,314792,467651,16611,810866,810865,810867,689857,724808,770756,228497,453578,39901,436121,367169,448487,710350,435942,436096,437496,828241,634169,650142,128083,39654,53012,435691,322353,322356,450591,662758,662772,437212,437936,322354,322355,322357,440729,24796,82448,189524,470150,395367,845720,368081,436616,438003,488364,435739,436579,436106,436575,39895,193335,195518,416857,51528,367159,392242,451087,288647,475399,436213,437890,437439,202257,462600,460367,322359,322360,328096,455379,455415,53443,464277,322358,455309,27194,72569,204681,445960,436659,53174,14198,38465,437001,488221,446265,201966,201983,682770,688612,671017,407628,37807,447367,412597,835011,433902,4939,452762,73163,727181,524,451277,339723,364145,366365,39569,77195,268341,53892,433717,465940,681657,352241,739057,435745,435876,435896,435594,435978,436144,437425,436703,437437,437509,437368,488694,490217,436126,493843,671456,482518,632931,437871,488735,324883,197738,197744,197740,700951,662737,33754,494302,40052,44759,452663,646992,37394,451403,436283,201976,51548,62739,9652,453272,451257,228466,454623,197054,197055,444453,451289,354226,207645,823890,205297,200558,45329,195774,436105,489278,739059,739090,739058,739094,739060,739095,739087,739085,739097,739101,739088,435992,436518,437250,438144,437487,436869,500194,435888,435718,484561,437877,436535,200917,186836,198739,207324,203258,642934,372886,372956,372960,494303,324880,459417,386047,49147,40507,197739,197741,45776,40508,36264,436423,372562,359037,435728,437153,437480,437993,488457,244817,355448,48946,204536,13912,454054,451310,454624,451636,444586,847023,40054,451733,446180,451730,460636,451274,451273,764804,641650,436884,436885,764805,630995,82560,437925,436937,24325,231000,775454,634167,451261,771938,444614,36432,437342,451288,451731,453980,503269,392859,392820,453193,454625,19065,468689,337098,486162,435880,435871,486953,481441,319873,460585,460792,460584,453267,453265,451287,451272,452184,233023,233024,41481,452110,52988,437859,844492,40057,451275,437508,49017,48901,39545,40509,459042,310982,470304,490209,810923,436221,437882,436810,436809,437329,488856,435573,436534,436176,437980,436529,461385,19719,776307,40285,662719,486008,437446,485705,483355,340945,435627,486843,486081,626355,1668,490212,436079,437444,437833,436499,438887,484954,436987,440566,437322,72774,438544,482314,436502,437852,482491,40511,436548,436299,437071,437373,447050]
    
    init() {
        loadVenusArt()
    }
    
    func loadVenusArt()
    {
        for object in venusObjects {
            guard let url = URL(string: "https://collectionapi.metmuseum.org/public/collection/v1/objects/" + String(object)) else {
                continue
            }
            self.getArt(with: url).receive(on: DispatchQueue.main).sink(receiveCompletion: { completion in }, receiveValue: { [weak self] data in
                if let stringURL = data.primaryImage, let name = data.title, let url = URL(string: stringURL) {
                    self?.artData.append(MetImageData(objectId: data.objectID, name: name, url: url, id: self?.artData.count ?? 0))
                }
            }).store(in: &self.cancellables)
       
        }
    }
    
    func loadSelectArt()
      {
          let min = segment * 50
          let max = min + 50
          guard max <= selectArt.count else {
              return
          }
          for i in min..<max {
              guard let url = URL(string: "https://collectionapi.metmuseum.org/public/collection/v1/objects/" + String(selectArt[i])) else {
                  continue
              }
              self.getArt(with: url).receive(on: DispatchQueue.main).sink(receiveCompletion: { completion in }, receiveValue: { [weak self] data in
                  if let stringURL = data.primaryImage, let name = data.title, let url = URL(string: stringURL) {
                      self?.artData.append(MetImageData(objectId: data.objectID, name: name, url: url, id: self?.artData.count ?? 0))
                  }
              }).store(in: &self.cancellables)
          }
      }
    
    
    func getArt(with url: URL) -> AnyPublisher<MetImage, Error> {
            
        return URLSession.shared.dataTaskPublisher(for: url).map { $0.data }
        .decode(type: MetImage.self, decoder: JSONDecoder())
        .mapError({ error in
                switch error {
                case is Swift.DecodingError:
                    print(error)
                  return FailureReason.decodingFailed
                case let urlError as URLError:
                  return FailureReason.sessionFailed(error: urlError)
                default:
                  return FailureReason.other(error)
                }
              })
        .eraseToAnyPublisher()
            
    }
}
